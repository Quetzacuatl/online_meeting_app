{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<div class="container my-5">
    <!-- Tabs for navigation -->
    <ul class="nav nav-tabs justify-content-center">
        <li class="nav-item">
            <a class="nav-link {% if view == 'profile' %}active{% endif %}" href="{{ url_for('dashboard', view='profile') }}">Profile</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if view == 'dashboard' %}active{% endif %}" href="{{ url_for('dashboard', view='dashboard') }}">Attendee Details</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if view == 'create_event' %}active{% endif %}" href="{{ url_for('dashboard', view='create_event') }}">Create Event</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if view == 'created_events' %}active{% endif %}" href="{{ url_for('dashboard', view='created_events') }}">Created Events</a>
        </li>
    </ul>

    <!-- Profile Section -->
    {% if view == 'profile' %}
    <div class="card shadow-lg p-4 mt-4">
        <h2 class="text-center">Edit Profile</h2>
        <form action="{{ url_for('edit_profile') }}" method="POST">
            <div class="mb-3">
                <label for="username" class="form-label">Name</label>
                <input type="text" class="form-control" id="username" name="username" value="{{ current_user.username }}" required>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" value="{{ current_user.email }}" required>
            </div>
            <div class="mb-3">
                <label for="iban" class="form-label">Payment Address (IBAN/CRYPTO)</label>
                <input type="text" class="form-control" id="iban" name="iban" value="{{ current_user.iban }}" required>
            </div>
            <hr>
            <h3>Default Email Templates</h3>
            <div class="mb-3">
                <label for="payment_email_title" class="form-label">Payment Email Title</label>
                <input type="text" class="form-control" id="payment_email_title" name="payment_email_title"
                    value="{{ current_user.payment_email_title }}" required>
            </div>
            <div class="mb-3">
                <label for="payment_email_body" class="form-label">Payment Instructions Email</label>
                <textarea class="form-control" id="payment_email_body" name="payment_email_body" rows="6" required>{{ current_user.payment_email_body }}</textarea>
            </div>
            <div class="mb-3">
                <label for="confirmation_email_title" class="form-label">Confirmation Email Title</label>
                <input type="text" class="form-control" id="confirmation_email_title" name="confirmation_email_title"
                    value="{{ current_user.confirmation_email_title }}" required>
            </div>
            <div class="mb-3">
                <label for="confirmation_email_body" class="form-label">Confirmation Email Body</label>
                <textarea class="form-control" id="confirmation_email_body" name="confirmation_email_body" rows="6" required>{{ current_user.confirmation_email_body }}</textarea>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
    {% endif %}

    <!-- Attendee Details Section -->
    {% if view == 'dashboard' %}
    <div class="card shadow-lg p-4 mt-4">
        <h2 class="text-center">Attendee Details for Your Events</h2>
        <table id="attendeeTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Google Meet URL</th>
                    <th>Attendee</th>
                    <th>Email</th>
                    <th>Payment Instruction Email Sent?</th>
                    <th>Payment Comment</th>
                </tr>
            </thead>
            <tbody>
                {% for row in table_data %}
                <tr>
                    <td>{{ row.event }}</td>
                    <td>{{ row.date }}</td>
                    <td><a href="{{ row.meeting_url }}" target="_blank">{{ row.meeting_url }}</a></td>
                    <td>{{ row.attendee_name }}</td>
                    <td>{{ row.attendee_email }}</td>
                    <td>{{ row.payment_sent }}</td>
                    <td>{{ row.payment_comment }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if view == 'create_event' %}
    <div class="card shadow-lg p-4 mt-4">
        <h2 class="text-center">Create Online Meeting Event</h2>
        <form action="{{ url_for('create_event') }}" method="POST">
            {% include "create_event.html" %}
        </form>
    </div>
    {% endif %}

    <!-- Created Events Section -->
    {% if view == 'created_events' %}
    <div class="card shadow-lg p-4 mt-4">
        <h2 class="text-center">Your Created Events</h2>
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for event in created_events %}
            <div class="col">
                <div class="card h-100 shadow">
                    <div class="card-body">
                        <h5 class="card-title">{{ event.title }}</h5>
                        <p class="card-text">{{ event.description }}</p>
                        <p class="card-text"><small>Date: {{ event.date.strftime('%Y-%m-%d %H:%M %Z') }}</small></p>
                        <p class="card-text"><small>Price: {{ event.price }} {{ event.currency }}</small></p>
                        <p class="card-text"><small>Max Attendees: {{ event.max_attendees }}</small></p>
                        <p class="card-text"><small>Meeting Link: <a href="{{ event.event_meeting_link }}" target="_blank">{{ event.event_meeting_link }}</a></small></p>
                    </div>
                    <div class="card-footer text-center">
                        <button class="btn btn-primary" onclick="copyShareURL('{{ url_for('home', _external=True) }}#event-{{ event.id }}')">Share</button>
                        <a href="{{ url_for('edit_event', event_id=event.id) }}" class="btn btn-secondary">Edit Event</a>
                    </div>
                    
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}
